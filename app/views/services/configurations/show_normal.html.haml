= render "layouts/order/nav", service: @service, step: 2

%h2.mb-4.font-weight-normal= t "service.normal.order.configuration"
%p.mb-4
  We need more information about your request.
  We will be able to process your request quicker
  if the form is filled with as much detail as possible.

= simple_form_for @project_item, url: service_configuration_path(@service), method: :put,
  html: { id: "order-form", "data-controller" => "project-item", "data-project-item-url" => projects_path } do |f|

  = render "services/configurations/voucher", project_item: @project_item, f: f

  .additional-information.mb-4.service-description
    %h5.mb-4.mt-5.font-weight-bold.configuration-title.text-uppercase
      Additional information

    %h4 My projects
    .details-content
      %p.mb-4= t("project.select.description")
      = f.input :project do
        .input-group.col-6.pl-0
          = f.input_field :project_id, collection: @projects,
            class: "form-control custom-select #{"is-invalid" unless @project_item.errors[:project].empty?}",
            "data-action" => "change->project-item#projectChanged",
            "data-target" => "project-item.project"
          .input-group-append
            = link_to "Add new project", new_project_path,
              class: "btn btn-primary", remote: true

    %h3 Usage
    %dl.mb-4
      %dt Customer typology
      %dd= t "simple_form.options.defaults.customer_typology.#{@project_item.project.customer_typology}"

      %dd{ "data-target" => "project-item.customerCountry" }

      %dd{ "data-target" => "project-item.reason" }

      %dd{ "data-target" => "project-item.customerCountry" }
      %dd{ "data-target" => "project-item.email" }
      %dd{ "data-target" => "project-item.customer" }
      %dd{ "data-target" => "project-item.collaborationCountry" }
      %dd{ "data-target" => "project-item.userGroupName" }
      %dd{ "data-target" => "project-item.projectName" }
      %dd{ "data-target" => "project-item.projectWebsiteUrl" }
      %dd{ "data-target" => "project-item.companyName" }
      %dd{ "data-target" => "project-item.companyWebsiteUrl" }
      %dd{ "data-target" => "project-item.organization" }
      %dd{ "data-target" => "project-item.department" }
      %dd{ "data-target" => "project-item.webpage" }
      %dd{ "data-target" => "project-item.additionalInformation" }

      = f.association :research_area, as: :grouped_select,
      collection: grouped_research_areas, group_method: :last


    - unless @project_item.property_values.blank?
      %h5.mb-3.font-weight-bold.configuration-title.text-uppercase Technical parameters
      = render "services/configurations/attributes", project_item: @project_item, form: f


= content_for :next_button do
  %button.btn.btn-primary{ form: "order-form", type: "submit" }
    Next

- if policy(@service).offers_show?
  = content_for :back_link do
    = link_to "Back to previous step - service offers",
              service_offers_path(@service),
              class: "text-uppercase"
