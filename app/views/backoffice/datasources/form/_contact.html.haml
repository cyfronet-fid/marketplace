- collapsed = collapsed?(datasource,
            [:"main_contact.first_name", :"main_contact.last_name",
            :"main_contact.email", :"public_contacts.email",
            :"main_contact.phone", :"public_contacts.phone",
            :public_contacts, :helpdesk_email, :security_contact_email])
.card.shadow-sm.rounded
  %button.btn.btn-link{ type: "button", class: ("collapsed" if collapsed),
              data: { toggle: "collapse", target: "#contact" },
              aria: { expanded: true, controls: "contact" } }
    .card-header.text-left{ id: "contact-header" }
      .row
        .col-10
          = _("Contact")
        .col-2.text-right
          .collapse-icon
            %i.fas.fa-chevron-down
            %i.fas.fa-chevron-up
.collapse{ id: "contact", "aria-labelledby": "contact-header",
        "data-parent": "#accordion-form",
        class: ("show" unless collapsed) }
  .card-body
    .row.service-contact-emails
      .col-12
        %h3
          = _("Main Contact")
        .contact
          = f.fields_for :main_contact do |main_contact_form|
            = main_contact_form.hidden_field :id, disabled: datasource.upstream_id.present?
            = main_contact_form.input :first_name, disabled: datasource.upstream_id.present?
            = main_contact_form.input :last_name, disabled: datasource.upstream_id.present?
            = main_contact_form.input :email, disabled: datasource.upstream_id.present?
            = main_contact_form.input :phone, disabled: datasource.upstream_id.present?
            = main_contact_form.input :position, disabled: datasource.upstream_id.present?
            = main_contact_form.input :organisation, disabled: datasource.upstream_id.present?
    .row.service-contact-emails{ "data-target": "service.publicContacts" }
      .col-12
        %h3
          = _("Public contacts")
        = f.error :public_contacts, class: "invalid-feedback d-block"
        = f.fields_for :public_contacts, disabled: datasource.upstream_id.present?, multiple: true, as: :array,
                wrapper_html: { "data-target" => "form.publicContact" } do |public_contact_form|
          = render "backoffice/common_parts/form/public_contact_fields",
          public_contact_form: public_contact_form, object: datasource, provider_form: false
        = link_to _("Add additional public contact"), "#", class: "btn btn-primary disablable",
          data: { target: "form.addField",
          action: "click->form#addField",
          value: "publicContacts",
          fields: f.fields_for(:public_contacts, PublicContact.new,
          child_index: "new_field") { |public_contact_form| render "backoffice/common_parts/form/public_contact_fields",
          public_contact_form: public_contact_form, object: datasource, provider_form: false } }
        = f.input :helpdesk_email, disabled: cant_edit(:helpdesk_email)
        = f.input :security_contact_email, disabled: cant_edit(:security_contact_email)
