- content_for :title, "Federation Services Search"
.container
  .row
    .col-12
      %h1 Federation Services Search

      %form#search-form.mb-4{ method: "get", action: federation_services_path,
      data: { controller: "federation-filters", federation_filters_target: "form" } }
        .row
          .col-md-8
            .form-group
              %input.form-control.form-control.form-control-lg{ type: "text",
                name: "q",
                value: params[:q],
                placeholder: "Search services by name, tagline or domain...",
                "aria-label": "Search services"
              }
          .col-md-4
            %button.btn.btn-primary.btn-lg.btn-block{ type: "submit" }
              %i.fas.fa-search.mr-2
              Search Services

        / Hidden inputs for nodes - będą aktualizowane przez JavaScript
        #hidden-nodes-container
          - if params[:nodes].present?
            - Array(params[:nodes]).each do |node_name|
              %input.hidden-node-input{ type: "hidden", name: "nodes[]", value: node_name }

        .row
          .col-lg-3.col-md-12
            #filters-collapse.mt-3
              - if @available_nodes.present?
                .filter-section.mb-4
                  %h6.filter-title.mb-3
                    Federation Nodes
                  .filter-options
                    - @available_nodes.each do |node|
                      .form-check.mb-2
                        %input.form-check-input.node-checkbox{ type: "checkbox",
                          value: node[:name],
                          id: "node_#{sanitize_for_id(node[:name])}",
                          checked: Array(params[:nodes]).include?(node[:name]),
                          data: { node_name: node[:name] }
                        }
                        %label.form-check-label{ for: "node_#{sanitize_for_id(node[:name])}" }
                          = node[:name]
              = render "federation/filters", filters: @facets

          .col-lg-9.col-md-12
            - if active_filters.present?
              .mb-3
                .d-flex.flex-wrap.align-items-center
                  %span.mr-2.font-weight-bold Active filters:
                  - active_filters.each do |filter|
                    %span.badge.badge-secondary.mr-1.mb-1
                      = filter[:name]
                      %a.text-white.ml-1{ href: filter[:remove_url] }
                        %i.fas.fa-times

            %h2 Search Results

            - if @json_data["results"].present?
              %h3
                Found #{@json_data["pagination"]["total_count"]} services
                - if params[:q].present?
                  for "#{params[:q]}"

              = render partial: "federation/services/service", collection: @json_data["results"], as: :service,
              locals: { highlights: @highlights }

              = render "federation/services/pagination", pagination: @json_data["pagination"]

            - elsif params[:q].present? || active_filters?
              .text-center.py-5
                %i.fas.fa-search.fa-3x.text-muted.mb-3
                %h4.text-muted No services found
                %p.text-muted Try adjusting your search criteria or filters.
            - else
              .text-center.py-5
                %i.fas.fa-rocket.fa-3x.text-primary.mb-3
                %h4 Discover Federation Services
                %p.text-muted Enter a search term above to find services from federated providers.

:css
  .service-card {
    transition: all 0.3s ease;
    border: 1px solid #e3e6f0;
  }

  .service-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    border-color: #5a5c69;
  }

  .service-meta {
    border-top: 1px solid #e3e6f0;
    padding-top: 1rem;
  }

  .service-content {
    min-width: 0; /* Pozwala na prawidłowe zachowanie flex-grow */
  }

  .service-logo {
    flex-shrink: 0;
    display: flex;
    align-items: flex-start;
    padding-top: 0.5rem;
  }

  .logo-img {
    width: 64px;
    height: 64px;
    object-fit: contain;
    border-radius: 4px;
    border: 1px solid #e3e6f0;
    padding: 4px;
    background-color: #fff;
  }

  /* Style dla highlightów */
  mark {
    background-color: #fff3cd;
    color: #856404;
    padding: 0 2px;
    border-radius: 2px;
  }
